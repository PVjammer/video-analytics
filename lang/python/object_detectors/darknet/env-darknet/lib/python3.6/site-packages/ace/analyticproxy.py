import argparse
import logging
import sys

from ace import analyticservice, analytic_pb2, aceclient

logging.basicConfig(level=logging.INFO)
log = logging.getLogger(__name__)

def proxy(req, resp):
    resp = client.process_frame(req)

if __name__=="__main__":
    parser = argparse.ArgumentParser()
    parser.add_argument("--cam_id", default=0, help="Camera ID to stream from")
    parser.add_argument("--host", default="localhost", help="Host of the proxy")
    parser.add_argument("--port", default=50060, help="Port the proxy will run on.")
    parser.add_argument("--analytic_addr", default="localhost:50051", help="Address of the analytic to send frames to.")

    args = parser.parse_args()
    client = aceclient.AceClient(args.analytic_addr)
    svc = analyticservice.AnalyticService()
    svc.RegisterProcessVideoFrame(proxy)
    sys.exit(svc.Run(analytic_port=args.port))


